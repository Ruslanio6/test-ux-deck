<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Тест UX Колоды</title>
  <style>
    body {
      font-family: Cygre, Inter, sans-serif;
      margin: 24px;
      text-align: left;
      display: flex;
      justify-content: center;
      background-color: #f6f7fd;
      
      
    }

    .section {
      display: none;
      font-size: 16px;
      padding: 20px;
      border: 2px solid #ede9f6;
      border-radius: 24px;
      width: 100%;
      max-width: 1024px;
      background-color: #ffffff;
    }

    .visible {
      display: block;
    }

    img {
      width: auto;
      height: 176px;
    }

    .checkbox-group {
      margin-top: 24px;
    }

    .checkbox-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      margin-bottom: 12px;
      border: 1px solid #ede9f6;
      border-radius: 12px;
      background-color: #f6f7fd;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .checkbox-item:hover {
      background-color: #e6e6fa;
    }

    .checkbox-item input[type="checkbox"] {
      transform: scale(1.3);
      cursor: pointer;
    }

    .next-button {
      margin-top: 30px;
      padding: 16px 24px;
      font-size: 18px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }

    .next-button:hover {
      background-color: #45a049;
    }

    h1, h2, p {
      text-align: left;
      color: #211C1D;
    }

    p {
    line-height: 24px;
    font-family: inter;
    font-weight: 500;
    font-size: 16px;
}
  </style>
  <script>
  let sectionIndex = 0;
  let startTime;
  let results = [];
  let sections = [];
  let currentDeckIndex = 0;

  const decks = Array.from({ length: 8 }, (_, i) => ({
    folder: `images/deck-${i + 1}`,
    name: `Колода ${i + 1}`
  }));

  function updateImages() {
    const folder = decks[currentDeckIndex].folder;
    const images = sections[1].querySelector("img");
    const boards = [2, 3, 4]; // Разделы 3, 4, 5

    // Картинка для "на руке"
    sections[1].querySelector("img").src = `${folder}/hand.png`;

    // Картинки для трёх бордов
    boards.forEach((sectionNum, idx) => {
      const img = sections[sectionNum].querySelector("img");
      img.src = `${folder}/board${idx + 1}.png`;
    });
  }

  function showSection(index) {
    if (index >= sections.length) {
      endTest();
      return;
    }

    sections.forEach(sec => sec.classList.remove("visible"));
    sections[index].classList.add("visible");

    document.getElementById("deck-name").textContent = decks[currentDeckIndex].name;
    resetCheckboxes();

    sectionIndex = index;
    startTime = Date.now();

    // При показе второго раздела — обновляем изображения
    if (sectionIndex === 1) {
      updateImages();
      // setTimeout(() => nextSection(), 1200);
    }
  }

  function nextSection() {
    const timeSpent = ((Date.now() - startTime) / 1000).toFixed(2);
    const checkboxes = document.querySelectorAll(".section.visible input[type='checkbox']:checked");
    const selected = Array.from(checkboxes).map(cb => cb.value);

    results.push(`К${currentDeckIndex + 1} | Р${sectionIndex + 1} | ${timeSpent} | ${selected.join(" ") || "Нет"}`);

    if (sectionIndex === 4) {
      currentDeckIndex++;
      if (currentDeckIndex < decks.length) {
        showSection(0);
      } else {
        endTest();
      }
    } else {
      // if (sectionIndex === 1) {
        // setTimeout(() => showSection(sectionIndex + 1), 2000);
      //} else
      //{
        showSection(sectionIndex + 1);
      //}
    }
  }

  function resetCheckboxes() {
    let checkboxes = document.querySelectorAll("input[type='checkbox']");
    checkboxes.forEach(cb => cb.checked = false);
  }

  function endTest() {
  // Анализ по каждой колоде
  const scores = [];
  const decksData = Array.from({ length: decks.length }, () => ({
    memorizationTime: null,
    answers: [],
    totalTime: 0,
  }));

  results.forEach(line => {
    const [deck, section, time, rawAnswers] = line.split(" | ");
    const deckIndex = parseInt(deck.replace("К", "")) - 1;
    const sectionIndex = parseInt(section.replace("Р", "")) - 1;
    const timeSpent = parseFloat(time);
    const isCorrect = rawAnswers.trim() !== "Нет"; // Заглушка — здесь будет сравнение позже

    if (sectionIndex === 1) {
      decksData[deckIndex].memorizationTime = timeSpent;
    } else if ([2, 3, 4].includes(sectionIndex)) {
      decksData[deckIndex].answers.push(isCorrect ? 1 : 0);
      decksData[deckIndex].totalTime += timeSpent;
    }
  });

  // Нормализация по макс значениям
  const maxMem = Math.max(...decksData.map(d => d.memorizationTime || 0));
  const maxAnsTime = Math.max(...decksData.map(d => d.totalTime / d.answers.length));

  decksData.forEach((data, i) => {
    const accuracy = data.answers.reduce((a, b) => a + b, 0) / data.answers.length;
    const normMem = 1 - (data.memorizationTime / maxMem || 0);
    const normAnsTime = 1 - ((data.totalTime / data.answers.length) / maxAnsTime || 0);
    const score = (accuracy * 0.5 + normMem * 0.3 + normAnsTime * 0.2) * 100;

    scores.push(`Колода ${i + 1} | Точность: ${(accuracy * 100).toFixed(1)}% | Время запоминания: ${data.memorizationTime}s | Сред. время ответа: ${(data.totalTime / data.answers.length).toFixed(2)}s | Балл: ${score.toFixed(1)}`);
  });

  const content = results.join("\n") + "\n\n---\n\n" + scores.join("\n");
  const blob = new Blob([content], { type: "text/plain" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "results.txt";
  link.click();

  document.body.innerHTML = `<h1>Тест завершен!</h1><p>Результаты сохранены как файл.</p>`;
}

// End endtest

  window.onload = function () {
    sections = document.querySelectorAll(".section");
    showSection(0);
  };
</script>
</head>
<body>

   <!-- Раздел 1 -->
  <div class="section visible">
    <h1>Исследование игральных карт</h1>
    <h2>Всего тестирую 8 колод, на каждую колоду по 3 борда. В среднем тест займет около 3х минут. Пожалуйста максимум внимания на тест, не отвлекайся!</h2>
    <p>Я покажу тебе 2 карты, у тебя будет 2 секунды чтоб их запомнить, будем считать что ты получил их на руку. После этого ты по порядку будешь видеть борды, никуда не торопись но и особо не медли, отмечай комбинации которые получилось бы собрать, если ты можешь собрать одновременно несколько комбинаций, отмечай их тоже. Сейчас будет тестироваться <span id="deck-name">Колода 1</span></p>
    <button class="next-button" onclick="nextSection()">Начать тест</button>
  </div>

  <!-- Раздел 2 -->
  <div class="section">
    <h2>Запомни карты</h2>
    <div>
    <img src="images/cards01.png" alt="Игральные карты" />
    </div>
    <button class="next-button" onclick="nextSection()">Далее</button>
  </div>

  <!-- Раздел 3 -->
  <div class="section">
    <h2>Какие комбинации ты можешь собрать?</h2>
    <img src="images/cards02.png" alt="Игральные карты" />
    <div class="checkbox-group">
      <label class="checkbox-item"><input type="checkbox" value="Пара" /> Пара</label>
      <label class="checkbox-item"><input type="checkbox" value="Две пары" /> Две пары</label>
      <label class="checkbox-item"><input type="checkbox" value="Сет" /> Сет</label>
      <label class="checkbox-item"><input type="checkbox" value="Стрит" /> Стрит</label>
      <label class="checkbox-item"><input type="checkbox" value="Флеш" /> Флеш</label>
      <label class="checkbox-item"><input type="checkbox" value="Фулл хаус" /> Фулл хаус</label>
      <label class="checkbox-item"><input type="checkbox" value="Каре" /> Каре</label>
    </div>
    <button class="next-button" onclick="nextSection()">Далее</button>
  </div>

  <!-- Раздел 4 -->
  <div class="section">
    <h2>Какие комбинации ты можешь собрать?</h2>
    <img src="images/cards03.png" alt="Игральные карты" />
    <div class="checkbox-group">
       <label class="checkbox-item"><input type="checkbox" value="Пара" /> Пара</label>
      <label class="checkbox-item"><input type="checkbox" value="Две пары" /> Две пары</label>
      <label class="checkbox-item"><input type="checkbox" value="Сет" /> Сет</label>
      <label class="checkbox-item"><input type="checkbox" value="Стрит" /> Стрит</label>
      <label class="checkbox-item"><input type="checkbox" value="Флеш" /> Флеш</label>
      <label class="checkbox-item"><input type="checkbox" value="Фулл хаус" /> Фулл хаус</label>
      <label class="checkbox-item"><input type="checkbox" value="Каре" /> Каре</label>
    </div>
    <button class="next-button" onclick="nextSection()">Далее</button>
  </div>

  <!-- Раздел 5 -->
  <div class="section">
    <h2>Какие комбинации ты можешь собрать?</h2>
    <img src="images/cards04.png" alt="Игральные карты" />
    <div class="checkbox-group">
      <label class="checkbox-item"><input type="checkbox" value="Пара" /> Пара</label>
      <label class="checkbox-item"><input type="checkbox" value="Две пары" /> Две пары</label>
      <label class="checkbox-item"><input type="checkbox" value="Сет" /> Сет</label>
      <label class="checkbox-item"><input type="checkbox" value="Стрит" /> Стрит</label>
      <label class="checkbox-item"><input type="checkbox" value="Флеш" /> Флеш</label>
      <label class="checkbox-item"><input type="checkbox" value="Фулл хаус" /> Фулл хаус</label>
      <label class="checkbox-item"><input type="checkbox" value="Каре" /> Каре</label>
    </div>
    <button class="next-button" onclick="nextSection()">Завершить тест колоды</button>
  </div>

</body>
</html>
